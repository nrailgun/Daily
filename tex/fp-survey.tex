\documentclass{ctexart}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{graphicx}

\bibliographystyle{plain}

\title{计算机视觉中的人脸关键点}
\author{吴俊宇 15212880}

\begin{document}

\maketitle

人脸关键点检测（\textbf{Facial landmark localization}）在许多相关的人脸相关问题(包括生物特征识别、情绪理解和人脸识别)中扮演了重要角
色，而这些问题都是是计算机视觉中的重要任务。人脸关键点检测问题事实上是非常具有挑战性的，因为这个问题涉及了空间尺度、人像姿势、表
情、人脸遮挡、光照和外貌差异。这篇文章主要讨论最近几年较为著名的人脸关键点检测技术。

关键点(landmark)这个翻译可能不尽准确，通常地标是指一些自然或人造的特征，这些特征与环境分离，清晰可见，指引方向。人脸关键点是指人脸上的若干关键位置，这些关键位置在后续的人脸相关识别任务中（人脸识别、人脸追踪，表情捕捉），起到了重要的作用。人脸关键点是优秀的特征，在许多问题中是重要的踏脚石。人脸关键点被分为两个大类，基准关键点和辅助关键点。嘴角、鼻尖这些部位可以较为容易的被低级图像特征（例如 SIFT 或 HoG）找到。这些比较容易找到的关键点通常称为基准关键点。基准关键点在人脸识别等任务中，起到了重要作用。辅助关键点的寻找被基准关键点所指导，通常是脸颊，眉毛等等。这些辅助关键点在表情理解中起到重要作用。

\begin{figure}
\centering
\includegraphics[width=0.7\linewidth]{pics/fp-example}
\caption[]{关键点检测例子}
\label{fig:fp-example}
\end{figure}

\section{人脸关键点技术的应用}

本章节列举人脸关键点通常被使用的应用场景。通常人脸关键点技术应用于人脸识别，表情分析，3D 人脸重建，人脸追踪，监控系统等等应用之中\cite{survey}。

\begin{description}
	\item[人脸识别] 人脸识别根据关键点定位（五官等）区域，提取有用特征。定位的坐标点也给给出了许多位置信息，比如角度和脸部五官之间的距离。
	\item[表情理解] 表情是没有声音和文字的语言，坐标点的空间格局提供了分析面部表情的工具。
	\item[人脸跟踪] 大部分人脸跟踪算法基于跟踪关键点序列。
\end{description}

\section{定位人脸关键点面临的挑战}

虽然人脸关键点识别在概念上非常简单，不过实际的计算机视觉问题中，却还存在许多挑战。首先对于类似于监控系统的软件，必须在嵌入式设备的有限运算力下，运行于实时；其次，实际应用中，算法健壮性尤为重要，必须对于形变、光照、姿势等等影响因素保持健壮。

在定位人脸关键点问题中主要的 3 个挑战：

\begin{description}
	\item[多变性] 关键点的外观受到了遮挡物（比如眼镜），姿势，光照，甚至是摄像头分辨率的影响，还受到人脸固有的个体差异的影响。
	有时候，手臂或者头发可能遮挡关键点的观察，光照和面部表情都让工作难上加难。目前还没有可以在计算资源有限的嵌入式设备上健壮的、
	有效的、实时的算法。
	\item[泛用性] 许多算法受到数据集的影响，一定程度上是 over-fit 的，在实际运用中，往往存在健壮性问题。
	\item[缺乏可靠的公开数据集] 虽然目前有很多公开的数据集，人脸关键点领域还缺乏公认的、低错误率的数据集（一些数据
	集精确度一般）。这严重妨碍了实际研究的展开。
\end{description}

\section{人脸关键点定位技术}

\subsection{Component based Deformable Model}

Yuchi Huang 提出 Component based Deformable Model（CDM），用于寻找人脸轮廓（Face alignment），通过统计学方法计算
局部与全局形状特征 \cite{cdm}。对 Shape components 使用独立的高斯模型，保留了更多的局部形态特征。更好地表示了 shape component 之间
的非线性相互关系。

\subsection{Deep Convolutional Network Cascade}

汤晓鸥等人提出一个三级连深度卷积神经网络模型（见图 \ref{fig:cascaded_cnn}），每个级联存在多个网络，意在希望多个网络可以给出更加健壮的输出 \cite{cascaded_cnn}。

\begin{figure}
\centering
\includegraphics[width=0.9\linewidth]{pics/cascaded_cnn}
\caption[]{Three-level cascaded convolutional networks}
\label{fig:cascaded_cnn}
\end{figure}

网络检查 5 个关键点：Left Eye（LE），Right Eye（RE），Noise tip（N），Left Mouth corner（LM），Right Mouth corner（RM）。
图 \ref{fig:cascaded_cnn} 是大致的网络结构。第一级联有 3 个卷积神经网络，各自覆盖一定的脸部区域，并产生数个关键点坐标，
结构如图\ref{fig:cascaded_cnn-f1} 所示。

\begin{figure}
	\centering
	\includegraphics[width=0.9\linewidth]{pics/cascaded_cnn-f1}
	\caption[]{Network in Cascaded CNN}
	\label{fig:cascaded_cnn-f1}
\end{figure}

在第一级联中，卷积神经网络在整个面部区域提取了高阶特征。在整个面部区域，许多的上下文信息都被用来参与寻找关键点。另外，
由于 5 个关键点同时被网络所预测，可以一定程度上保持面部关键点之间的空间约束。因此，网络得以避免二义性和数据损坏导致的
局部最优。在 2 级和 3 级级联中，网络逐步微调输出结果，以期达到更好的预测结果准确性。

作者提出了网络设计的三个关键点：

\begin{description}
	\item [网络的深度] 预测关键点位置属于高级任务，深度网络帮助提取全局的高级特征，而底层的网络层因为 receptive field
	较小，提取的是局部的低级特征。其次，高阶特征经常是非线性的，增加更多的层可以增加更多的非线性，使之更加有效的表示
	输入与输出的关系。
	\item [ReLU 的使用] 通常卷积神经元之后的激活函数只有一个，Sigmoid，$\tanh$，或者 ReLU （Absolute value Rectification）。
	而这个 Cascaded CNN 使用了 $\max(\tanh(x), 0)$ 的独特形式。这一形式大大提升了网络的性能。作者在实验中证明其非常有效。
	在我的实验中，发现其实去掉 $\tanh$ 也能表现很好，主导作用可能来自于 ReLU。
	\item [局部的权重共享] 通常卷积神经网络使用全局共享权值 \cite{lff-conv}。因为特定的空间特征，如果可以被滤波器在
	某个区域捕捉，那么在其他区域也可以被捕捉，其次避免了梯度扩散的问题，减少参数数量也可以加速神经网络训练。但是，
	全局权重共享对于人脸关键点检测这种有着特定空间分布的问题可能并不适用，眼睛和嘴巴拥有类似的低级特征（边缘相似），
	但是在高级语义级别，他们是完全不同的。所以对于那些有着不同语义的区域，局部的权重共享可能更好。

	局部权重共享的卷积神经网络的卷积层可以表示为
	$$
	y_{i, j}^{(t)} = \tanh \left(
	\sum_{r=0}^{m-1} \sum_{k=0}^{s-1} \sum_{l=0}^{s-1} x_{i+k, j+l}^{(r)} \centerdot
	w_{k, l}^{(r, u, v, t)} + b^{(u, v, t)}
	\right)
	$$
	其中，$s$ 是卷积核的边长，$n$ 是卷积核的数量，$p$ 和 $q$ 是权重共享参数，$m$ 是上一层的卷积核的数目，$x$ 是输入，
	$y$ 是输出。
\end{description}

网络使用归一化的 MSE 作为损失函数：
$$
\mathrm{err} = \frac { \sqrt{ (x - x')^2 + (y - y')^2 } } {l}
$$
其中，$x$、$y$、$x'$ 和 $y'$ 分别是预测坐标和 Ground truth 坐标，$l$ 是人脸检测器给出的脸部宽度，作归一化。

这个网络结构使用于关键点不多的情况，随着关键点增多，网络收敛会越来越困难，也越来越不准确。

\subsection{Coarse-to-fine Convolutional Network Cascade}

3 级联卷积神经网络表现出了良好的准确率，4 级联卷积神经网络表现更加惊人 \cite{cascaded4_cnn}，将问题分解为 Coarse-to-fine，由粗到细的过程。网络的每一个级联调整上一个级联面部关键点的预测结果，预测更加精准的空间约束。

网络第一级联预测得到 bounding box 和轮廓点；第二级联预测一个初始的位置预测；第三级联和最后的级联提取预测位置的 Patch（包括
旋转变换），进行更加精准的调整。

这个方法流程较为复杂，但是适用于关键点更多的场合。

\subsection{Supervised Descent Mothod}

Xuehan Xiong 提出 Supervised Descent Method（SDM）来定位人脸关键点 \cite{sdm}。
许多计算机视觉问题，都是通过非线性优化方法来解决。许多人认为 2 阶下降方法是较为健壮，快速，和可靠
的方法（尽管目前流行的深度学习方法使用的是更加简单的随机梯度下降方法）。

虽然牛顿方法是一个比我奶奶还要年长的算法，但是这不妨碍他作为一个 2 阶导数存在时候可用的优秀算法。
牛顿方法假定平滑函数 $f(x)$ 可以被 quadratic function 逼近，如果 Hessian 矩阵是正定的，那么最小值
可以通过求解线性方程组得到。牛顿方法创造了一个升级参数的序列：
$$
x_{k+1} = x_k - H^{-1}(x_k) J_f(x_k)
$$
其中 $ H(x_k)$ 和 $J_f(x_k)$ 是 Hessian 矩阵和 Jacobian 矩阵。牛顿方法收敛很快，而且可以很好接近最优解。
但是牛顿方法也存在一些不足，首先函数未必可导（比如 SIFT），数值逼近不切实际；其次 Hessian 矩阵可能非常巨大；
再次，它不一定是正定的。

\begin{figure}
\centering
\includegraphics[width=0.7\linewidth]{pics/sdm-example}
\caption{SDM 方法}
\label{fig:sdm-example}
\end{figure}

图 \ref{fig:sdm-example} 阐述了 SDM 方法的思想。（a）图表示将牛顿方法应用与 Nonlinear Least Squares 问题，
$f(x)$ 是非线性函数，而 $y$ 是已知矢量。（b）图阐述了 SDM 方法背后的思想。训练数据包括了在不同 $y^i$
（人脸）采样的函数集合 $\left\{ f(x, y^i) \right\}$，最优解 $\left\{ x^i_* \right\}$ 已知。通过训练数据，
SDM 学习一系列的参数升级方向，这些参数升级方向将使得误差逐步下降。

给定图 $d \in \mathcal{R}^{m\times 1}$，$d(x) \in \mathcal{R}^{p \times 1}$ 索引图像中的 $p$ 个关键点，$h$ 是非线性特征
提取函数（例如，SIFT），并且假定已知已知关键点坐标为 $x_*$。关键点问题可以抽象为极小化函数：
$$
f(x_0 + \Delta x) = \| h(d(x_0 + \Delta x)) - \Phi_* \|_2^2
$$
其中 $\Phi_* = h(d(x_*))$。在训练集中，$\Delta x$ 和 $\Phi_*$ 是已知的。

假定 $h$ 二阶可导（事实上不是），那么可以展开目标函数为：
$$
f(x_0 + \Delta x) \approx f(x_0) + J_f(x_0)^T \Delta x + \frac 1 2 \Delta x^T H(x_0) \Delta x
$$
可以得到升级为
$$
\Delta x_k = -H^{-1} J_f = -2 H^{-1} J_h^T(\phi_{k-1} - \phi_*)
$$

由于 $h$ 事实上不可导，SDM 采用了这样的方法：
$$
x_k = x_{k-1} + R_{k-1} \phi_{k-1} + b_{k-1}
$$
$R_k$ 和 $b_k$ 就是参数升级方向，也是学习的目标，通过求解
$$
\arg\min_{R_k, b_k} \sum_{d^i} \sum_{x_k^i} \| \Delta x_*^{ki} - R_k \phi_k^i - b_k \|^2
$$
得到，而 $R_0$ 和 $b_0$ 通过求解
$$
\arg\min_{R_0, b_0} \sum_{d^i} \sum_{x_0^i} \| \Delta x_*^{i} - R_0 \phi_0^i - b_0 \|^2
$$
得到。

对比于卷积神经网络，SDM 方法的准确性还不能比拟，但是 SDM 方法收敛速度非常快，计算资源消耗少，
这是卷积神经网络没有的优点。

\section{性能衡量}

通常衡量人脸关键点预测的性能指标有两个：

\begin{itemize}
	\item 与 Ground truth 定位的差距（经常是欧氏距离）
	\item 面向任务目标的特定指标
\end{itemize}

最直接的评估人脸关键点定位性能的指标就是和手工标记的坐标进行比较，性能好坏取决于计算结果的准确性。
准确性可以通过 normalized root mean square error 或者 normalized mean square error 来衡量。眼距通常
用来作为归一化的准绳，通过将坐标除以眼距来做归一化可以避免摄像头距离或者缩放导致的差异。

\section{结语}

本文主要讨论了关键点识别问题及其遇到的困难，和几种较为著名的方法，重点介绍了 Cascaded CNN 和 SDM 方法。人脸关键点
的工作是计算机视觉中非常重要的问题，因此研究这个问题很有意义。不过还是很容易发现，目前人脸关键点定位问题中，
卷积神经网络的占到了极强的主导地位，不仅效果拔群，而且简单易懂。虽然实际应用中，卷积神经网络的训练与调整是一个
非常依赖经验的黑科技，但是这不能阻止他的脚步。

这篇文章大部分来自我读的 Paper 和实验的笔记，今天写出来分享，谢谢老师。

\pagebreak
\bibliography{fp-survey.bib}

\end{document}